---
import {
  fetchStrapi,
  fetchStrapiSingle,
  type MenuItem,
  type StrapiResponse,
} from "../lib/strapi";
import { mockMenuItems, mockHomepage } from "../lib/mockData";
import SimpleMenuCard from "../components/SimpleMenuCard.astro";
import Hero from "../components/Hero.astro";
import Navigation from "../components/Navigation.astro";
import Footer from "../components/Footer.astro";
import BaseLayout from "../layouts/BaseLayout.astro";

// ‚ö° RESILIENT BUILD-TIME DATA FETCHING
// All Strapi API calls execute during build (astro build), NOT at runtime.
// If Strapi is unavailable, mock data ensures the build succeeds gracefully.
// The final output is pure static HTML that works even if Strapi goes down.

// Fetch real data from Strapi
const strapiMenu = await fetchStrapi<MenuItem>("menu-items");
const strapiHomepage = await fetchStrapiSingle("homepage");

// Use Strapi data if available, otherwise fall back to mock data
const menu = strapiMenu?.data?.length ? strapiMenu : mockMenuItems;
const homepage = strapiHomepage?.data ? strapiHomepage : mockHomepage;

const heroSection = homepage?.data?.attributes?.heroSection;
const heroData = Array.isArray(heroSection) ? heroSection[0] : heroSection;

// Get featured menu items for homepage (first 3)
const featuredItems = menu.data.slice(0, 3);

// Track if we're using mock data
const usingMockData = !strapiMenu?.data?.length;
---

<BaseLayout
  title="Edgardo's Grill - Bacolod Authentic Inasal"
  description="Experience authentic Bacolod inasal and Filipino grill specialties. Fresh, flavorful, and made with passion."
>
  <Navigation currentPage="home" />

  <!-- Hero Section -->
  <Hero heroData={heroData} />

  <!-- Why Choose Us Section -->
  <section class="py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2
        class="text-4xl font-serif font-bold text-center mb-12 text-primary-700 tracking-wide"
      >
        Why Choose Edgardo's?
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="text-center p-6">
          <div class="text-5xl mb-4">üî•</div>
          <h3
            class="text-xl font-serif font-semibold mb-2 text-primary-700 tracking-wide"
          >
            Authentic Inasal
          </h3>
          <p class="text-text-dark">
            Traditional Bacolod-style grilling with secret marinades passed
            through generations.
          </p>
        </div>
        <div class="text-center p-6">
          <div class="text-5xl mb-4">üë®‚Äçüç≥</div>
          <h3
            class="text-xl font-serif font-semibold mb-2 text-primary-700 tracking-wide"
          >
            Expert Grill Masters
          </h3>
          <p class="text-text-dark">
            Our experienced grill masters bring passion and skill to every
            perfectly charred dish.
          </p>
        </div>
        <div class="text-center p-6">
          <div class="text-5xl mb-4">‚≠ê</div>
          <h3
            class="text-xl font-serif font-semibold mb-2 text-primary-700 tracking-wide"
          >
            Filipino Hospitality
          </h3>
          <p class="text-text-dark">
            Experience warm, authentic Filipino service that makes every meal
            special.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Menu Preview Section -->
  <section
    id="menu"
    class="py-20 bg-gradient-to-br from-background to-accent-50"
  >
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2
        class="text-4xl font-serif font-bold text-center mb-4 text-primary-700 tracking-wide"
      >
        Featured Inasal & Grill
      </h2>
      <p class="text-center text-text-dark mb-12 text-lg">
        Discover our signature Bacolod-style grilled specialties
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {featuredItems.map((item) => <SimpleMenuCard item={item} />)}
      </div>

      <div class="text-center mt-12">
        <a
          href="/menu"
          class="inline-block bg-secondary-600 hover:bg-secondary-700 text-white font-semibold px-8 py-3 rounded-full transition-all duration-300 shadow-warm-lg hover:shadow-warm-xl hover:translate-y-[-2px]"
        >
          View Full Menu
        </a>
      </div>
    </div>
  </section>

  <Footer />
</BaseLayout>
