---
export interface Props {
  currentPage?: "home" | "menu" | "about" | "contact";
}

const { currentPage = "home" } = Astro.props;

const isActive = (page: string) => currentPage === page;
---

<nav class="bg-white shadow-md sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <div class="flex items-center">
        <a href="/" class="text-2xl font-bold text-primary-700"
          >Restaurant Name</a
        >
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex space-x-8">
        <a
          href="/"
          class={`font-medium transition-colors ${isActive("home") ? "text-accent-600" : "text-primary-700 hover:text-accent-600"}`}
          >Home</a
        >
        <a
          href="/menu"
          class={`font-medium transition-colors ${isActive("menu") ? "text-accent-600" : "text-primary-700 hover:text-accent-600"}`}
          >Menu</a
        >
        <a
          href="/about"
          class={`font-medium transition-colors ${isActive("about") ? "text-accent-600" : "text-primary-700 hover:text-accent-600"}`}
          >About</a
        >
        <a
          href="/contact"
          class={`font-medium transition-colors ${isActive("contact") ? "text-accent-600" : "text-primary-700 hover:text-accent-600"}`}
          >Contact</a
        >
      </div>

      <!-- Hamburger Menu Button (Mobile/Tablet Only) -->
      <button
        id="mobile-menu-button"
        class="md:hidden flex flex-col justify-center items-center w-10 h-10 focus:outline-none focus:ring-2 focus:ring-accent-500 rounded-lg transition-all"
        aria-label="Open navigation menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <span
          class="hamburger-line w-6 h-0.5 bg-primary-700 transition-all duration-300 ease-in-out"
        ></span>
        <span
          class="hamburger-line w-6 h-0.5 bg-primary-700 mt-1.5 transition-all duration-300 ease-in-out"
        ></span>
        <span
          class="hamburger-line w-6 h-0.5 bg-primary-700 mt-1.5 transition-all duration-300 ease-in-out"
        ></span>
      </button>
    </div>
  </div>
</nav>

<!-- Mobile Menu Overlay (Semi-transparent backdrop) -->
<div
  id="mobile-menu-overlay"
  class="fixed inset-0 bg-black/60 z-40 opacity-0 pointer-events-none transition-opacity duration-300 ease-in-out backdrop-blur-sm"
  aria-hidden="true"
>
</div>

<!-- Mobile Menu Drawer (Slides in from right) -->
<div
  id="mobile-menu"
  class="fixed top-0 right-0 h-full w-80 max-w-[85vw] bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out z-50 overflow-y-auto"
  role="dialog"
  aria-label="Mobile navigation menu"
  aria-modal="true"
>
  <div class="flex flex-col h-full">
    <!-- Header with Close Button -->
    <div
      class="flex justify-between items-center p-4 border-b border-gray-200 bg-gradient-to-r from-primary-50 to-accent-50"
    >
      <span class="text-xl font-bold text-primary-700">Menu</span>
      <button
        id="mobile-menu-close"
        class="flex items-center justify-center w-10 h-10 text-primary-700 hover:text-accent-600 focus:outline-none focus:ring-2 focus:ring-accent-500 rounded-lg transition-all duration-200"
        aria-label="Close navigation menu"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Navigation Links -->
    <nav class="flex flex-col p-6 space-y-2 flex-grow" aria-label="Primary">
      <a
        href="/"
        class={`mobile-nav-link text-lg font-medium py-3 px-4 rounded-lg transition-all duration-200 ${isActive("home") ? "bg-accent-100 text-accent-700" : "text-primary-700 hover:bg-primary-50 hover:text-accent-600 active:bg-accent-50"}`}
      >
        <span class="flex items-center">
          <svg
            class="w-5 h-5 mr-3"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
            ></path>
          </svg>
          Home
        </span>
      </a>
      <a
        href="/menu"
        class={`mobile-nav-link text-lg font-medium py-3 px-4 rounded-lg transition-all duration-200 ${isActive("menu") ? "bg-accent-100 text-accent-700" : "text-primary-700 hover:bg-primary-50 hover:text-accent-600 active:bg-accent-50"}`}
      >
        <span class="flex items-center">
          <svg
            class="w-5 h-5 mr-3"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
            ></path>
          </svg>
          Menu
        </span>
      </a>
      <a
        href="/about"
        class={`mobile-nav-link text-lg font-medium py-3 px-4 rounded-lg transition-all duration-200 ${isActive("about") ? "bg-accent-100 text-accent-700" : "text-primary-700 hover:bg-primary-50 hover:text-accent-600 active:bg-accent-50"}`}
      >
        <span class="flex items-center">
          <svg
            class="w-5 h-5 mr-3"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            ></path>
          </svg>
          About
        </span>
      </a>
      <a
        href="/contact"
        class={`mobile-nav-link text-lg font-medium py-3 px-4 rounded-lg transition-all duration-200 ${isActive("contact") ? "bg-accent-100 text-accent-700" : "text-primary-700 hover:bg-primary-50 hover:text-accent-600 active:bg-accent-50"}`}
      >
        <span class="flex items-center">
          <svg
            class="w-5 h-5 mr-3"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
            ></path>
          </svg>
          Contact
        </span>
      </a>
    </nav>

    <!-- Footer section with branding -->
    <div class="p-6 border-t border-gray-200 bg-gray-50">
      <p class="text-sm text-gray-600 text-center">Â© 2026 Restaurant Name</p>
    </div>
  </div>
</div>

<script>
  // Mobile menu toggle functionality with enhanced features
  const menuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const mobileMenuOverlay = document.getElementById("mobile-menu-overlay");
  const closeButton = document.getElementById("mobile-menu-close");
  const hamburgerLines = menuButton?.querySelectorAll(".hamburger-line");

  let isMenuOpen = false;

  function openMenu() {
    if (isMenuOpen) return;

    isMenuOpen = true;

    // Slide in menu
    mobileMenu?.classList.remove("translate-x-full");

    // Show overlay with fade-in
    mobileMenuOverlay?.classList.remove("pointer-events-none");
    mobileMenuOverlay?.classList.add("pointer-events-auto");
    setTimeout(() => {
      mobileMenuOverlay?.classList.remove("opacity-0");
      mobileMenuOverlay?.classList.add("opacity-100");
    }, 10);

    // Prevent body scroll
    document.body.style.overflow = "hidden";

    // Update ARIA attributes
    menuButton?.setAttribute("aria-expanded", "true");
    mobileMenuOverlay?.setAttribute("aria-hidden", "false");

    // Animate hamburger to X
    if (hamburgerLines && hamburgerLines.length >= 3) {
      hamburgerLines[0].style.transform = "rotate(45deg) translateY(8px)";
      hamburgerLines[1].style.opacity = "0";
      hamburgerLines[2].style.transform = "rotate(-45deg) translateY(-8px)";
    }

    // Focus trap: focus the close button
    closeButton?.focus();
  }

  function closeMenu() {
    if (!isMenuOpen) return;

    isMenuOpen = false;

    // Slide out menu
    mobileMenu?.classList.add("translate-x-full");

    // Hide overlay with fade-out
    mobileMenuOverlay?.classList.remove("opacity-100");
    mobileMenuOverlay?.classList.add("opacity-0");
    setTimeout(() => {
      mobileMenuOverlay?.classList.remove("pointer-events-auto");
      mobileMenuOverlay?.classList.add("pointer-events-none");
    }, 300);

    // Restore body scroll
    document.body.style.overflow = "";

    // Update ARIA attributes
    menuButton?.setAttribute("aria-expanded", "false");
    mobileMenuOverlay?.setAttribute("aria-hidden", "true");

    // Reset hamburger icon
    if (hamburgerLines && hamburgerLines.length >= 3) {
      hamburgerLines[0].style.transform = "";
      hamburgerLines[1].style.opacity = "1";
      hamburgerLines[2].style.transform = "";
    }
  }

  // Event listeners
  menuButton?.addEventListener("click", (e) => {
    e.stopPropagation();
    if (isMenuOpen) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  closeButton?.addEventListener("click", closeMenu);
  mobileMenuOverlay?.addEventListener("click", closeMenu);

  // Close menu when clicking navigation links
  const mobileNavLinks = mobileMenu?.querySelectorAll(".mobile-nav-link");
  mobileNavLinks?.forEach((link) => {
    link.addEventListener("click", () => {
      closeMenu();
    });
  });

  // Close menu when pressing ESC key
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && isMenuOpen) {
      closeMenu();
      menuButton?.focus(); // Return focus to menu button
    }
  });

  // Handle viewport resize - close menu if window is resized to desktop
  let resizeTimer: number;
  window.addEventListener("resize", () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      if (window.innerWidth >= 768 && isMenuOpen) {
        closeMenu();
      }
    }, 250);
  });

  // Prevent scroll on touch devices when menu is open
  mobileMenu?.addEventListener(
    "touchmove",
    (e) => {
      e.stopPropagation();
    },
    { passive: true }
  );
</script>

<style>
  /* Ensure proper z-index stacking */
  #mobile-menu-overlay {
    z-index: 40;
  }

  #mobile-menu {
    z-index: 50;
  }

  /* Smooth transitions for hamburger icon */
  .hamburger-line {
    transform-origin: center;
  }

  /* Touch-friendly tap targets */
  .mobile-nav-link {
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }

  /* Prevent overscroll on mobile menu */
  #mobile-menu {
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
  }

  /* Focus styles for accessibility */
  #mobile-menu-button:focus-visible,
  #mobile-menu-close:focus-visible,
  .mobile-nav-link:focus-visible {
    outline: 2px solid theme("colors.accent.500");
    outline-offset: 2px;
  }
</style>
